<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Notification System</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
      }

      .controls {
        padding: 30px;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #495057;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #4facfe;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .btn-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
      }

      .btn-warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .btn-danger {
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        color: white;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .notifications-container {
        padding: 30px;
      }

      .notification-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border-left: 5px solid #4facfe;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .notification-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          rgba(79, 172, 254, 0.05) 0%,
          rgba(0, 242, 254, 0.05) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .notification-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .notification-card:hover::before {
        opacity: 1;
      }

      .notification-card.jee {
        border-left-color: #ff6b6b;
      }

      .notification-card.gate {
        border-left-color: #4ecdc4;
      }

      .notification-card.jee_adv {
        border-left-color: #45b7d1;
      }

      .notification-card.upsc {
        border-left-color: #96ceb4;
      }

      .notification-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .notification-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
        flex: 1;
      }

      .notification-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .meta-item {
        background: #f8f9fa;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        color: #6c757d;
      }

      .notification-content {
        color: #495057;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .notification-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 12px;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #4facfe;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
      }

      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 10px;
        padding: 15px 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        border-left: 4px solid #4facfe;
      }

      .toast.show {
        transform: translateX(0);
      }

      .toast.success {
        border-left-color: #28a745;
      }

      .toast.error {
        border-left-color: #dc3545;
      }

      .toast.warning {
        border-left-color: #ffc107;
      }

      .fade-in {
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .slide-in {
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🎓 Demo Notification System</h1>
        <p>Add, edit, and manage exam notifications with real-time updates</p>
      </div>

      <div class="controls">
        <h2 style="margin-bottom: 20px; color: #2c3e50">
          Add New Notification
        </h2>
        <form id="notificationForm">
          <div class="form-row">
            <div class="form-group">
              <label for="title">Title *</label>
              <input
                type="text"
                id="title"
                name="title"
                required
                placeholder="Enter notification title"
              />
            </div>
            <div class="form-group">
              <label for="examType">Exam Type *</label>
              <select id="examType" name="examType" required>
                <option value="">Select exam type</option>
                <option value="jee">JEE Main</option>
                <option value="jee_adv">JEE Advanced</option>
                <option value="gate">GATE</option>
                <option value="upsc">UPSC</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="source">Source</label>
              <input
                type="text"
                id="source"
                name="source"
                placeholder="e.g., NTA, IIT, etc."
              />
            </div>
            <div class="form-group">
              <label for="priority">Priority</label>
              <select id="priority" name="priority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="content">Content *</label>
            <textarea
              id="content"
              name="content"
              required
              placeholder="Enter notification content"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="url">URL</label>
              <input
                type="url"
                id="url"
                name="url"
                placeholder="https://example.com"
              />
            </div>
            <div class="form-group">
              <label for="date">Date</label>
              <input type="date" id="date" name="date" />
            </div>
          </div>

          <button type="submit" class="btn btn-primary">
            <span>✨ Add Notification</span>
          </button>
          <button type="button" class="btn btn-warning" onclick="clearForm()">
            <span>🗑️ Clear Form</span>
          </button>
        </form>
      </div>

      <div class="notifications-container">
        <div class="stats" id="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">Total Notifications</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="jeeCount">0</div>
            <div class="stat-label">JEE Main</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="gateCount">0</div>
            <div class="stat-label">GATE</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="jeeAdvCount">0</div>
            <div class="stat-label">JEE Advanced</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="upscCount">0</div>
            <div class="stat-label">UPSC</div>
          </div>
        </div>

        <h2 style="margin-bottom: 20px; color: #2c3e50">Notifications</h2>
        <div id="notificationsList">
          <div class="empty-state">
            <div style="font-size: 4rem; margin-bottom: 20px">📝</div>
            <h3>No notifications yet</h3>
            <p>Add your first notification using the form above</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let notifications = [];
      let nextId = 1;

      // Load notifications from server on page load
      async function loadNotifications() {
        try {
          const response = await fetch("/demo/notifications");
          const data = await response.json();

          if (data.success) {
            notifications = data.notifications || [];
            nextId = Math.max(...notifications.map((n) => n.id), 0) + 1;
          }
        } catch (error) {
          console.error("Error loading notifications:", error);
          // Fallback to localStorage
          const saved = localStorage.getItem("demoNotifications");
          if (saved) {
            notifications = JSON.parse(saved);
            nextId = Math.max(...notifications.map((n) => n.id), 0) + 1;
          }
        }
        renderNotifications();
        updateStats();
      }

      // Save notifications to server
      async function saveNotifications() {
        try {
          const response = await fetch("/demo/notifications", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ notifications: notifications }),
          });

          const data = await response.json();
          if (!data.success) {
            console.error("Failed to save notifications:", data.error);
            // Fallback to localStorage
            localStorage.setItem(
              "demoNotifications",
              JSON.stringify(notifications)
            );
          }
        } catch (error) {
          console.error("Error saving notifications:", error);
          // Fallback to localStorage
          localStorage.setItem(
            "demoNotifications",
            JSON.stringify(notifications)
          );
        }
      }

      // Add new notification
      function addNotification(notificationData) {
        const notification = {
          id: nextId++,
          title: notificationData.title,
          content: notificationData.content,
          examType: notificationData.examType,
          source: notificationData.source || "Demo",
          priority: notificationData.priority || "medium",
          url: notificationData.url || "",
          date: notificationData.date || new Date().toISOString().split("T")[0],
          scrapedAt: new Date().toISOString(),
          contentHash: generateHash(
            notificationData.title + notificationData.content
          ),
        };

        notifications.unshift(notification);
        saveNotifications();
        renderNotifications();
        updateStats();
        showToast("Notification added successfully!", "success");
      }

      // Edit notification
      function editNotification(id) {
        const notification = notifications.find((n) => n.id === id);
        if (!notification) return;

        // Populate form with notification data
        document.getElementById("title").value = notification.title;
        document.getElementById("content").value = notification.content;
        document.getElementById("examType").value = notification.examType;
        document.getElementById("source").value = notification.source;
        document.getElementById("priority").value = notification.priority;
        document.getElementById("url").value = notification.url;
        document.getElementById("date").value = notification.date;

        // Remove notification from list
        notifications = notifications.filter((n) => n.id !== id);
        saveNotifications();
        renderNotifications();
        updateStats();

        // Scroll to form
        document
          .querySelector(".controls")
          .scrollIntoView({ behavior: "smooth" });
        showToast("Notification loaded for editing", "warning");
      }

      // Delete notification
      function deleteNotification(id) {
        if (confirm("Are you sure you want to delete this notification?")) {
          notifications = notifications.filter((n) => n.id !== id);
          saveNotifications();
          renderNotifications();
          updateStats();
          showToast("Notification deleted successfully!", "success");
        }
      }

      // Render notifications
      function renderNotifications() {
        const container = document.getElementById("notificationsList");

        if (notifications.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 4rem; margin-bottom: 20px;">📝</div>
                        <h3>No notifications yet</h3>
                        <p>Add your first notification using the form above</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = notifications
          .map(
            (notification) => `
                <div class="notification-card ${notification.examType} fade-in">
                    <div class="notification-header">
                        <div>
                            <div class="notification-title">${escapeHtml(
                              notification.title
                            )}</div>
                            <div class="notification-meta">
                                <span class="meta-item">${notification.examType.toUpperCase()}</span>
                                <span class="meta-item">${
                                  notification.source
                                }</span>
                                <span class="meta-item">${
                                  notification.priority
                                }</span>
                                <span class="meta-item">${formatDate(
                                  notification.scrapedAt
                                )}</span>
                            </div>
                        </div>
                    </div>
                    <div class="notification-content">${escapeHtml(
                      notification.content
                    )}</div>
                    ${
                      notification.url
                        ? `<div style="margin-bottom: 15px;"><a href="${notification.url}" target="_blank" style="color: #4facfe; text-decoration: none;">🔗 View Source</a></div>`
                        : ""
                    }
                    <div class="notification-actions">
                        <button class="btn btn-primary btn-sm" onclick="editNotification(${
                          notification.id
                        })">
                            ✏️ Edit
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteNotification(${
                          notification.id
                        })">
                            🗑️ Delete
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Update statistics
      function updateStats() {
        const total = notifications.length;
        const jee = notifications.filter((n) => n.examType === "jee").length;
        const gate = notifications.filter((n) => n.examType === "gate").length;
        const jeeAdv = notifications.filter(
          (n) => n.examType === "jee_adv"
        ).length;
        const upsc = notifications.filter((n) => n.examType === "upsc").length;

        document.getElementById("totalCount").textContent = total;
        document.getElementById("jeeCount").textContent = jee;
        document.getElementById("gateCount").textContent = gate;
        document.getElementById("jeeAdvCount").textContent = jeeAdv;
        document.getElementById("upscCount").textContent = upsc;

        // Add pulse animation to changed stats
        [total, jee, gate, jeeAdv, upsc].forEach((count, index) => {
          const element = document.querySelectorAll(".stat-number")[index];
          if (count > 0) {
            element.classList.add("pulse");
            setTimeout(() => element.classList.remove("pulse"), 2000);
          }
        });
      }

      // Clear form
      function clearForm() {
        document.getElementById("notificationForm").reset();
        showToast("Form cleared", "warning");
      }

      // Show toast notification
      function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${getToastIcon(type)}</span>
                    <span>${message}</span>
                </div>
            `;

        document.body.appendChild(toast);

        setTimeout(() => toast.classList.add("show"), 100);
        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => document.body.removeChild(toast), 300);
        }, 3000);
      }

      // Get toast icon based on type
      function getToastIcon(type) {
        const icons = {
          success: "✅",
          error: "❌",
          warning: "⚠️",
          info: "ℹ️",
        };
        return icons[type] || icons.info;
      }

      // Utility functions
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function generateHash(text) {
        let hash = 0;
        for (let i = 0; i < text.length; i++) {
          const char = text.charCodeAt(i);
          hash = (hash << 5) - hash + char;
          hash = hash & hash; // Convert to 32-bit integer
        }
        return hash.toString();
      }

      // Form submission
      document
        .getElementById("notificationForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const notificationData = {
            title: formData.get("title"),
            content: formData.get("content"),
            examType: formData.get("examType"),
            source: formData.get("source"),
            priority: formData.get("priority"),
            url: formData.get("url"),
            date: formData.get("date"),
          };

          addNotification(notificationData);
          this.reset();
        });

      // Set today's date as default
      document.getElementById("date").value = new Date()
        .toISOString()
        .split("T")[0];

      // Load notifications on page load
      loadNotifications();

      // Add some demo notifications if none exist
      if (notifications.length === 0) {
        const demoNotifications = [
          {
            title: "JEE Main 2024 Registration Extended",
            content:
              "The registration deadline for JEE Main 2024 has been extended to December 15, 2023. Students can now register through the official NTA website.",
            examType: "jee",
            source: "NTA",
            priority: "high",
            url: "https://jeemain.nta.ac.in",
            date: "2024-01-15",
          },
          {
            title: "GATE 2024 Admit Card Released",
            content:
              "GATE 2024 admit cards are now available for download. Candidates can access their admit cards from the official GATE website using their login credentials.",
            examType: "gate",
            source: "IIT",
            priority: "high",
            url: "https://gate.iit.ac.in",
            date: "2024-01-10",
          },
          {
            title: "UPSC Civil Services Prelims 2024 Notification",
            content:
              "Union Public Service Commission has released the notification for Civil Services Preliminary Examination 2024. The exam is scheduled for May 26, 2024.",
            examType: "upsc",
            source: "UPSC",
            priority: "medium",
            url: "https://upsc.gov.in",
            date: "2024-01-05",
          },
        ];

        demoNotifications.forEach((notification) => {
          addNotification(notification);
        });
      }
    </script>
  </body>
</html>
